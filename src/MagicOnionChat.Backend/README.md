# MagicOnionChat — Distributed Production Chat

## Краткое описание

Приложение реализует Production-ready чат на C# с использованием MagicOnion (gRPC) и Redis Pub/Sub.  
Система поддерживает многократные инстансы backend (Docker), синхронизирует сообщения и серверные уведомления между всеми подключёнными клиентами.
  
---  

## Запуск проекта

### 1. Запуск backend в Docker

Перейдите в папку **MagicOnionChat.Backend** и запустите:`docker-compose up -d --build`

Это поднимет Redis и несколько инстансов backend (`chat-backend-1`, `chat-backend-2`).

### 2. Запуск клиента

Перейдите в папку клиента **MagicOnionChat.Client**.

Запуск первого клиента на первом инстансе: `dotnet run -- 8081`

Откройте новый терминал и повторите команду для второго инстанса: `dotnet run -- 8082`

Можно открыть столько клиентов, сколько нужно, указывая нужный порт/инстанс. Все сообщения и уведомления будут синхронизированы между всеми клиентами и серверами.
  
---  

## Проверка многократных инстансов

- Для обычного теста — запустите один клиент.
- Для тестирования синхронизации — запустите несколько клиентов, каждый соединяется с отдельным портом (инстансом backend).
- Backend автоматически отправляет серверные уведомления согласно бизнес-логике (например, периодические сообщения).

---  

## Использование ИИ

Для анализа документации, поиска оптимального паттерна и конфигурирования был использован Perplexity Pro.

**Промпты:**  
- Как правильно использовать Hub-Context Pattern и настраивать его в DI для поддержки нескольких инстансов через Redis? Приведи пример best-practice кода для MagicOnion StreamingHub в .NET 8.
- Как настроить переменные окружения в docker?
- Какие есть нюансы при настройке MagicOnion + Redis (MagicOnion 7.0.6 и MagicOnion.Server.Redis 7.0.6)?
- Покажи минимальный пример кода для подключения .NET 8 консольного клиента к серверу StreamingHub (MagicOnion) с указанием порта через аргументы командной строки, корректной обработкой ошибок подключения и gRPC, а также с демонстрацией получения и отправки чата и серверных уведомлений; используй современные подходы и основывайся на официальной документации: https://github.com/Cysharp/MagicOnion и https://cysharp.github.io/MagicOnion/advanced/memorypack

**Что принято полностью:**
- Архитектура Hub-Context Pattern
- Методы DI и регистрация сервисов
- Примеры запуска Hub клиента

**Что менялось вручную:**
- Смена Kestrel listening с ListenLocalhost на ListenAnyIP (для Docker/клиентов)
- Обработка ошибок и внедрение ExceptionHandler
- background-сервисы
- Структура папок